#!/usr/bin/env bash

function copy_from_setup {
  path=$1
  file=$(basename $path)
  echo "Copying $file to $path"
  curl https://raw.githubusercontent.com/config-setup/setup/refs/heads/main/$file -o $path &> /dev/null
}

function clone_or_pull {
  if [ -d "$2" ]; then
    echo "git pull $1"
    pushd $2 &> /dev/null
    git pull &> /dev/null 
    popd &> /dev/null 
  else
    echo "git clone $@"
    git clone $@ &> /dev/null
  fi
}

asdf=~/.asdf/bin/asdf
function asdf_latest {
  $asdf plugin add $1
  $asdf install $1 latest
  $asdf global $1 latest
}

# ohmyzsh
if ! command -v omz 2>&1 >/dev/null; then
  echo "Installing ohmyzsh"
  sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" &> /dev/null
else
  echo "Updating ohmyzsh"
  omz update &> /dev/null&
fi

# deps
# apt update &> /dev/null
# apt install git software-properties-common python3-pip zsh tmux ninja-build gettext cmake unzip curl build-essential -y &> /dev/null

# git
git config --global user.name "Reggles"
git config --global user.email "reginaldbeakes@gmail.com"
git config --global credential.helper store
git config --global init.defaultBranch main
git config --global push.autoSetupRemote true

# config files
copy_from_setup ~/.zshrc

# config flies in git
clone_or_pull https://github.com/config-setup/local-bin.git ~/.local/bin/
clone_or_pull https://github.com/config-setup/tmux.git ~/.config/tmux
clone_or_pull https://github.com/config-setup/nvim.git ~/.config/nvim
clone_or_pull https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
clone_or_pull https://github.com/asdf-vm/asdf.git ~/.asdf

asdf_latest fzf
asdf_latest starship
asdf_latest neovim
asdf_latest python
asdf_latest nodejs
asdf_latest golang
asdf_latest rust

